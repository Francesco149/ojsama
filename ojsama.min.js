var osu={};if(typeof exports!=="undefined"){osu=exports}(function(){osu.VERSION_MAJOR=1;osu.VERSION_MINOR=0;osu.VERSION_PATCH=16;var t={warn:Function.prototype};if(typeof exports!=="undefined"){t=console}var i=function(t,i){var s=new Array(t.length);for(var e=0;e<s.length;++e){s[e]=t[e].toFixed(i)}return s};function s(t){return typeof t==="undefined"}function e(t){this.time=t.time||0;this.ms_per_beat=t.ms_per_beat;if(this.ms_per_beat===undefined){this.ms_per_beat=600}this.change=t.change;if(this.change===undefined){this.change=true}}e.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"ms_per_beat: "+this.ms_per_beat.toFixed(2)+" }"};var r={circle:1<<0,slider:1<<1,spinner:1<<3};function n(t){this.pos=t.pos||[0,0]}n.prototype.toString=function(){return"pos: ["+i(this.pos,2)+"]"};function a(t){this.pos=t.pos||[0,0];this.distance=t.distance||0;this.repetitions=t.repetitions||1}a.prototype.toString=function(){return"pos: "+i(this.pos,2)+", "+"distance: "+this.distance.toFixed(2)+", "+"repetitions: "+this.repetitions};function o(t){this.time=t.time||0;this.type=t.type||0;if(!s(t.data))this.data=t.data}o.prototype.typestr=function(){var t="";if(this.type&r.circle)t+="circle | ";if(this.type&r.slider)t+="slider | ";if(this.type&r.spinner)t+="spinner | ";return t.substring(0,Math.max(0,t.length-3))};o.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"type: "+this.typestr()+(this.data?", "+this.data.toString():"")+" }"};var h={std:0};function p(){this.reset()}p.prototype.reset=function(){this.format_version=1;this.mode=h.std;this.title=this.title_unicode="";this.artist=this.artist_unicode="";this.creator="";this.version="";this.ar=undefined;this.cs=this.od=this.hp=5;this.sv=this.tick_rate=1;this.ncircles=this.nsliders=this.nspinners=0;if(!this.objects){this.objects=[]}else{this.objects.length=0}if(!this.timing_points){this.timing_points=[]}else{this.timing_points.length=0}return this};p.prototype.max_combo=function(){var t=this.ncircles+this.nspinners;var i=-1;var s=Number.NEGATIVE_INFINITY;var e=0;for(var n=0;n<this.objects.length;++n){var a=this.objects[n];if(!(a.type&r.slider)){continue}while(a.time>=s){++i;if(this.timing_points.length>i+1){s=this.timing_points[i+1].time}else{s=Number.POSITIVE_INFINITY}var o=this.timing_points[i];var h=1;if(!o.change&&o.ms_per_beat<0){h=-100/o.ms_per_beat}if(this.format_version<8){e=this.sv*100}else{e=this.sv*100*h}}var p=a.data;var c=p.distance*p.repetitions/e;var m=Math.ceil((c-.1)/p.repetitions*this.tick_rate);--m;m*=p.repetitions;m+=p.repetitions+1;t+=Math.max(0,m)}return t};p.prototype.toString=function(){var t=this.artist+" - "+this.title+" [";if(this.title_unicode||this.artist_unicode){t+="("+this.artist_unicode+" - "+this.title_unicode+")"}t+=this.version+"] mapped by "+this.creator+"\n"+"\n"+"AR"+parseFloat(this.ar.toFixed(2))+" "+"OD"+parseFloat(this.od.toFixed(2))+" "+"CS"+parseFloat(this.cs.toFixed(2))+" "+"HP"+parseFloat(this.hp.toFixed(2))+"\n"+this.ncircles+" circles, "+this.nsliders+" sliders, "+this.nspinners+" spinners"+"\n"+this.max_combo()+" max combo"+"\n";return t};function c(){this.map=new p;this.reset()}c.prototype.reset=function(){this.map.reset();this.nline=0;this.curline="";this.lastpos="";this.section="";return this};c.prototype.feed_line=function(t){this.curline=this.lastpos=t;++this.nline;if(t.startsWith(" ")||t.startsWith("_")){return this}t=this.curline=t.trim();if(t.length<=0){return this}if(t.startsWith("//")){return this}if(t.startsWith("[")){if(this.section=="Difficulty"&&s(this.map.ar)){this.map.ar=this.map.od}this.section=t.substring(1,t.length-1);return this}if(!t){return this}switch(this.section){case"Metadata":this._metadata();break;case"General":this._general();break;case"Difficulty":this._difficulty();break;case"TimingPoints":this._timing_points();break;case"HitObjects":this._objects();break;default:var i=t.indexOf("file format v");if(i<0){break}this.map.format_version=parseInt(t.substring(i+13));break}return this};c.prototype.feed=function(t){var i=i=t.split("\n");for(var s=0;s<i.length;++s){this.feed_line(i[s])}return this};c.prototype.toString=function(){return"at line "+this.nline+"\n"+this.curline+"\n"+"-> "+this.lastpos+" <-"};c.prototype._setpos=function(t){this.lastpos=t.trim();return this.lastpos};c.prototype._warn=function(){t.warn.apply(null,Array.prototype.slice.call(arguments));t.warn(this.toString())};c.prototype._property=function(){var t=this.curline.split(":",2);t[0]=this._setpos(t[0]);t[1]=this._setpos(t[1]);return t};c.prototype._metadata=function(){var t=this._property();switch(t[0]){case"Title":this.map.title=t[1];break;case"TitleUnicode":this.map.title_unicode=t[1];break;case"Artist":this.map.artist=t[1];break;case"ArtistUnicode":this.map.artist_unicode=t[1];break;case"Creator":this.map.creator=t[1];break;case"Version":this.map.version=t[1];break}};c.prototype._general=function(){var t=this._property();if(t[0]!=="Mode"){return}this.map.mode=parseInt(this._setpos(t[1]))};c.prototype._difficulty=function(){var t=this._property();switch(t[0]){case"CircleSize":this.map.cs=parseFloat(this._setpos(t[1]));break;case"OverallDifficulty":this.map.od=parseFloat(this._setpos(t[1]));break;case"ApproachRate":this.map.ar=parseFloat(this._setpos(t[1]));break;case"HPDrainRate":this.map.hp=parseFloat(this._setpos(t[1]));break;case"SliderMultiplier":this.map.sv=parseFloat(this._setpos(t[1]));break;case"SliderTickRate":this.map.tick_rate=parseFloat(this._setpos(t[1]));break}};c.prototype._timing_points=function(){var t=this.curline.split(",");if(t.length>8){this._warn("timing point with trailing values")}else if(t.length<2){this._warn("ignoring malformed timing point");return}var i=new e({time:parseFloat(this._setpos(t[0])),ms_per_beat:parseFloat(this._setpos(t[1]))});if(t.length>=7){i.change=t[6].trim()!=="0"}this.map.timing_points.push(i)};c.prototype._objects=function(){var t=this.curline.split(",");var i;if(t.length>11){this._warn("object with trailing values")}else if(t.length<4){this._warn("ignoring malformed hitobject");return}var s=new o({time:parseFloat(this._setpos(t[2])),type:parseInt(this._setpos(t[3]))});if(isNaN(s.time)||isNaN(s.type)){this._warn("ignoring malformed hitobject");return}if((s.type&r.circle)!=0){++this.map.ncircles;i=s.data=new n({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))]});if(isNaN(i.pos[0])||isNaN(i.pos[1])){this._warn("ignoring malformed circle");return}}else if((s.type&osu.objtypes.spinner)!=0){++this.map.nspinners}else if((s.type&osu.objtypes.slider)!=0){if(t.length<8){this._warn("ignoring malformed slider");return}++this.map.nsliders;i=s.data=new a({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))],repetitions:parseInt(this._setpos(t[6])),distance:parseFloat(this._setpos(t[7]))});if(isNaN(i.pos[0])||isNaN(i.pos[1])||isNaN(i.repetitions)||isNaN(i.distance)){this._warn("ignoring malformed slider");return}}this.map.objects.push(s)};var m={nomod:0,nf:1<<0,ez:1<<1,td:1<<2,hd:1<<3,hr:1<<4,dt:1<<6,ht:1<<8,nc:1<<9,fl:1<<10,so:1<<12};m.from_string=function(t){var i=0;t=t.toLowerCase();while(t!=""){var s=1;for(var e in m){if(e.length!=2){continue}if(!m.hasOwnProperty(e)){continue}if(t.startsWith(e)){i|=m[e];s=2;break}}t=t.slice(s)}return i};m.string=function(t){var i="";for(var s in m){if(s.length!=2){continue}if(!m.hasOwnProperty(s)){continue}if(t&m[s]){i+=s.toUpperCase()}}if(i.indexOf("DT")>=0&&i.indexOf("NC")>=0){i=i.replace("DT","")}return i};m.speed_changing=m.dt|m.ht|m.nc;m.map_changing=m.hr|m.ez|m.speed_changing;var l=79.5;var u=19.5;var f=1800;var d=1200;var _=450;var v=(l-u)/10;var g=(f-d)/5;var b=(d-_)/5;function y(t,i,s){var e=t;e*=s;var r=e<5?f-g*e:d-b*(e-5);r=Math.min(f,Math.max(_,r));r/=i;e=r>d?(f-r)/g:5+(d-r)/b;return e}function w(t,i,s){var e=t;e*=s;var r=l-Math.ceil(v*e);r=Math.min(l,Math.max(u,r));r/=i;e=(l-r)/v;return e}function M(t){this.ar=t.ar;this.od=t.od;this.hp=t.hp;this.cs=t.cs;this.speed_mul=1;this._mods_cache={}}M.prototype.with_mods=function(t){if(this._mods_cache[t]){return this._mods_cache[t]}var i=this._mods_cache[t]=new M(this);if(!(t&m.map_changing)){return i}if(t&(m.dt|m.nc))i.speed_mul=1.5;if(t&m.ht)i.speed_mul*=.75;var s=1;if(t&m.hr)s=1.4;if(t&m.ez)s*=.5;if(i.ar){i.ar=y(i.ar,i.speed_mul,s)}if(i.od){i.od=w(i.od,i.speed_mul,s)}if(i.cs){if(t&m.hr)i.cs*=1.3;if(t&m.ez)i.cs*=.5;i.cs=Math.min(10,i.cs)}if(i.hp){i.hp*=s;i.hp=Math.min(10,i.hp)}return i};function j(t){this.obj=t;this.reset()}j.prototype.reset=function(){this.strains=[0,0];this.normpos=[0,0];this.is_single=false;return this};j.prototype.toString=function(){return"{ strains: ["+i(this.strains,2)+"], normpos: ["+i(this.normpos,2)+"], is_single: "+this.is_single+" }"};function x(t,i){return[t[0]-i[0],t[1]-i[1]]}function F(t,i){return[t[0]*i[0],t[1]*i[1]]}function N(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}var k=0;var I=1;var S=90;var T=110;var E=125;var O=[.3,.15];var A=[1400,26.25];var R=.9;var z=400;var C=30;var D=.0675;var P=[512,384];var q=F(P,[.5,.5]);var V=.5;function W(){this.objects=[];this.reset();this.map=undefined;this.mods=m.nomod;this.singletap_threshold=125}W.prototype.reset=function(){this.total=0;this.aim=0;this.speed=0;this.nsingles=0;this.nsingles_threshold=0};W.prototype.calc=function(t){var i=this.map=t.map||this.map;if(!i){throw new TypeError("no map given")}var s=this.mods=t.mods||this.mods;var e=this.singletap_threshold=t.singletap_threshold||e;var n=new M({cs:i.cs}).with_mods(s);var a=n.speed_mul;this._init_objects(this.objects,i,n.cs);this.speed=this._calc_individual(k,this.objects,a);this.aim=this._calc_individual(I,this.objects,a);this.speed=Math.sqrt(this.speed)*D;this.aim=Math.sqrt(this.aim)*D;if(s&m.td){this.aim=Math.pow(this.aim,.8)}this.total=this.aim+this.speed+Math.abs(this.speed-this.aim)*V;this.nsingles=0;this.nsingles_threshold=0;for(var o=1;o<this.objects.length;++o){var h=this.objects[o].obj;var p=this.objects[o-1].obj;if(this.objects[o].is_single){++this.nsingles}if(!(h.type&(r.circle|r.slider))){continue}var c=(h.time-p.time)/a;if(c>=e){++this.nsingles_threshold}}return this};W.prototype.toString=function(){return this.total.toFixed(2)+" stars ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed)"};W.prototype._spacing_weight=function(t,i){switch(t){case I:return Math.pow(i,.99);case k:if(i>E){return 2.5}else if(i>T){return 1.6+.9*(i-T)/(E-T)}else if(i>S){return 1.2+.4*(i-S)/(T-S)}else if(i>S/2){return.95+.25*(i-S/2)/(S/2)}return.95}throw{name:"NotImplementedError",message:"this difficulty type does not exist"}};W.prototype._calc_strain=function(t,i,s,e){var n=i.obj;var a=s.obj;var o=0;var h=(n.time-a.time)/e;var p=Math.pow(O[t],h/1e3);if((n.type&(r.slider|r.circle))!=0){var c=N(x(i.normpos,s.normpos));if(t==k){i.is_single=c>E}o=this._spacing_weight(t,c);o*=A[t]}o/=Math.max(h,50);i.strains[t]=s.strains[t]*p+o};W.prototype._calc_individual=function(t,i,s){var e=[];var r=z*s;var n=r;var a=0;var o;for(o=0;o<i.length;++o){if(o>0){this._calc_strain(t,i[o],i[o-1],s)}while(i[o].obj.time>n){e.push(a);if(o>0){var h=Math.pow(O[t],(n-i[o-1].obj.time)/1e3);a=i[o-1].strains[t]*h}else{a=0}n+=r}a=Math.max(a,i[o].strains[t])}var p=1;var c=0;e.sort(function(t,i){return i-t});for(o=0;o<e.length;++o){c+=e[o]*p;p*=R}return c};W.prototype._normalizer_vector=function(t){var i=P[0]/16*(1-.7*(t-5)/5);var s=52/i;if(i<C){s*=1+Math.min(C-i,5)/50}return[s,s]};W.prototype._init_objects=function(i,s,e){if(i.length!=s.objects.length){i.length=s.objects.length}var n=this._normalizer_vector(e);var a=F(q,n);for(var o=0;o<i.length;++o){if(!i[o]){i[o]=new j(s.objects[o])}else{i[o].reset()}var h=i[o].obj;if(h.type&r.spinner){i[o].normpos=a.slice();continue}var p;if(h.type&(r.slider|r.circle)){p=h.data.pos}else{t.warn("unknown object type ",h.type.toString(16));p=[0,0]}i[o].normpos=F(p,n)}};function H(){this.calculators=[];this.map=undefined}H.prototype.calc=function(t){var i;var s=this.map=t.map||this.map;if(!s){throw new TypeError("no map given")}if(!this.calculators[s.mode]){switch(s.mode){case h.std:i=new W;break;default:throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}this.calculators[s.mode]=i}else{i=this.calculators[s.mode]}return i.calc(t)};function U(t){this.nmiss=t.nmiss||0;if(t.n300===undefined){this.n300=-1}else{this.n300=t.n300}this.n100=t.n100||0;this.n50=t.n50||0;if(t.percent){var i=t.nobjects;if(i===undefined){throw new TypeError("nobjects is required when specifying percent")}this.nmiss=Math.min(i,this.nmiss);var s=i-this.nmiss;var e=new U({n300:s,n100:0,n50:0,nmiss:this.nmiss}).value()*100;var r=t.percent;r=Math.max(0,Math.min(e,r));this.n100=Math.round(-3*((r*.01-1)*i+this.nmiss)*.5);if(this.n100>s){this.n100=0;this.n50=Math.round(-6*((r*.01-1)*i+this.nmiss)*.5);this.n50=Math.min(s,this.n50)}this.n300=i-this.n100-this.n50-this.nmiss}}U.prototype.value=function(t){var i=this.n300;if(i<0){if(!t){throw new TypeError("either n300 or nobjects must be specified")}i=t-this.n100-this.n50-this.nmiss}else{t=i+this.n100+this.n50+this.nmiss}var s=(i*300+this.n100*100+this.n50*50)/(t*300);return Math.max(0,Math.min(s,1))};U.prototype.toString=function(){return(this.value()*100).toFixed(2)+"% "+this.n100+"x100 "+this.n50+"x50 "+this.nmiss+"xmiss"};function G(){this.aim=0;this.speed=0;this.acc=0;this.computed_accuracy=undefined}G.prototype.calc=function(t){var i=t.stars;var e=t.map;var r,n,a,o,h,p;var c;var l,u;if(i){e=i.map}if(e){r=e.max_combo();n=e.nsliders;a=e.ncircles;o=e.objects.length;h=e.ar;p=e.od;if(!i){i=(new W).calc(t)}}else{r=t.max_combo;if(!r||r<0){throw new TypeError("max_combo must be > 0")}n=t.nsliders;a=t.ncircles;o=t.nobjects;if([n,a,o].some(isNaN)){throw new TypeError("nsliders, ncircles, nobjects are required (must be numbers) ")}if(o<n+a){throw new TypeError("nobjects must be >= nsliders + ncircles")}h=t.base_ar;if(s(h))h=5;p=t.base_od;if(s(p))p=5}if(i){c=i.mods;l=i.aim;u=i.speed}else{c=t.mods||m.nomod;l=t.aim_stars;u=t.speed_stars}if([l,u].some(isNaN)){throw new TypeError("aim and speed stars required (must be numbers)")}var f=t.nmiss||0;var d=t.n50||0;var _=t.n100||0;var v=t.n300;if(v===undefined)v=o-_-d-f;var g=t.combo;if(g===undefined)g=r-f;var b=t.score_version||1;var y=o/2e3;var w=.95+.4*Math.min(1,y);if(o>2e3){w+=Math.log10(y)*.5}var j=Math.pow(.97,f);var x=Math.pow(g,.8)/Math.pow(r,.8);var F=new M({ar:h,od:p}).with_mods(c);this.computed_accuracy=new U({percent:t.acc_percent,nobjects:o,n300:v,n100:_,n50:d,nmiss:f});v=this.computed_accuracy.n300;_=this.computed_accuracy.n100;d=this.computed_accuracy.n50;var N=this.computed_accuracy.value();var k=1;if(F.ar>10.33){k+=.45*(F.ar-10.33)}else if(F.ar<8){var I=.01*(8-F.ar);if(c&m.hd){I*=2}k+=I}var S=this._base(l);S*=w;S*=j;S*=x;S*=k;if(c&m.hd)S*=1.02+(11-F.ar)/50;if(c&m.fl)S*=1.45*w;var T=.5+N/2;var E=.98+F.od*F.od/2500;S*=T;S*=E;this.aim=S;var O=this._base(u);O*=w;O*=j;O*=x;O*=T;O*=E;if(c&m.hd)O*=1.18;this.speed=O;var A=N;switch(b){case 1:var R=o-n-a;A=new U({n300:Math.max(0,v-n-R),n100:_,n50:d,nmiss:f}).value();A=Math.max(0,A);break;case 2:a=o;break;default:throw new{name:"NotImplementedError",message:"unsupported scorev"+b}}var z=Math.pow(1.52163,F.od)*Math.pow(A,24)*2.83;z*=Math.min(1.15,Math.pow(a/1e3,.3));if(c&m.hd)z*=1.02;if(c&m.fl)z*=1.02;this.acc=z;var C=1.12;if(c&m.nf)C*=.9;if(c&m.so)C*=.95;this.total=Math.pow(Math.pow(S,1.1)+Math.pow(O,1.1)+Math.pow(z,1.1),1/1.1)*C;return this};G.prototype.toString=function(){return this.total.toFixed(2)+" pp ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed, "+this.acc.toFixed(2)+" acc)"};G.prototype._base=function(t){return Math.pow(5*Math.max(1,t/.0675)-4,3)/1e5};function Y(t){var i;if(t.map){i=t.map.mode}else{i=t.mode||h.std}switch(i){case h.std:return(new G).calc(t)}throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}osu.timing=e;osu.objtypes=r;osu.circle=n;osu.slider=a;osu.hitobject=o;osu.modes=h;osu.beatmap=p;osu.parser=c;osu.modbits=m;osu.std_beatmap_stats=M;osu.std_diff_hitobject=j;osu.std_diff=W;osu.diff=H;osu.std_accuracy=U;osu.std_ppv2=G;osu.ppv2=Y})();